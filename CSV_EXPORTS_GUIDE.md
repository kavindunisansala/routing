# CSV Export Guide for VANET Security Analysis

This document describes all CSV files generated by the routing simulation for attack detection and mitigation analysis.

## üìä Available CSV Exports

### 1. **wormhole-attack-results.csv**
**Generated when:** `--enable_wormhole_attack=true` (using enhanced wormhole with WormholeAttackManager)

**Purpose:** Track wormhole attack statistics and tunnel performance

**Columns:**
```
TunnelID,Node1,Node2,TunneledPackets,DroppedPackets,PacketsSent,PacketsReceived,TunnelStartTime,TunnelStopTime,Status
```

**Example Usage:**
```bash
./waf --run "routing --enable_wormhole_attack=true"
```

**Analysis Insights:**
- Which nodes are participating in wormhole tunnels
- How many packets are being tunneled
- Tunnel activity timeline
- Packet drop statistics

---

### 2. **wormhole-detection-results.csv**
**Generated when:** `--enable_wormhole_detection=true`

**Purpose:** Evaluate wormhole detection effectiveness using latency-based analysis

**Columns:**
```
Metric,Value
DetectionEnabled,true/false
MitigationEnabled,true/false
LatencyThresholdMultiplier,<value>
BaselineLatency_ms,<ms>
TotalFlows,<count>
FlowsAffected,<count>
FlowsDetected,<count>
AffectedPercentage,<percent>
AvgNormalLatency_ms,<ms>
AvgWormholeLatency_ms,<ms>
AvgLatencyIncrease_percent,<percent>
RouteChangesTriggered,<count>
NodesBlacklisted,<count>
```

**Example Usage:**
```bash
./waf --run "routing --enable_wormhole_attack=true --enable_wormhole_detection=true"
```

**Analysis Insights:**
- Detection accuracy (flows detected vs flows affected)
- Latency anomaly magnitude
- Mitigation effectiveness (route changes, blacklisted nodes)
- False positive rate

---

### 3. **blackhole-attack-results.csv**
**Generated when:** `--enable_blackhole_attack=true`

**Purpose:** Track blackhole attack behavior and packet dropping statistics

**Columns:**
```
NodeID,PacketsDropped,PacketsTunneled,IsAttacker,AttackStartTime,AttackStopTime
```

**Example Usage:**
```bash
./waf --run "routing --enable_blackhole_attack=true --blackhole_attack_percentage=0.15"
```

**Analysis Insights:**
- Which nodes are acting as blackhole attackers
- Total packets dropped per attacker
- Attack timeline
- Attack coverage percentage

---

### 4. **blackhole-mitigation-results.csv** ‚ú® NEW
**Generated when:** `--enable_blackhole_mitigation=true`

**Purpose:** Evaluate blackhole mitigation effectiveness using PDR-based detection

**Columns:**
```
NodeID,PacketsSentVia,PacketsDelivered,PacketsDropped,PDR,Blacklisted,BlacklistTime
```

**Example Usage:**
```bash
./waf --run "routing --enable_blackhole_attack=true --enable_blackhole_mitigation=true --blackhole_pdr_threshold=0.5"
```

**Analysis Insights:**
- Which nodes were blacklisted as suspected attackers
- Packet delivery ratio (PDR) for each node
- Detection timing (when nodes were blacklisted)
- Mitigation effectiveness (comparing PDR before/after blacklisting)

---

### 5. **packet-delivery-analysis.csv** ‚ú® NEW
**Generated when:** `--enable_packet_tracking=true`

**Purpose:** Detailed per-packet analysis for performance evaluation and attack impact assessment

**Columns:**
```
PacketID,SourceNode,DestNode,SendTime,ReceiveTime,DelayMs,Delivered,WormholeOnPath,BlackholeOnPath
```

**Field Descriptions:**
- **PacketID**: Unique packet identifier (ns-3 UID)
- **SourceNode**: ID of the node that sent the packet
- **DestNode**: ID of the destination node
- **SendTime**: Simulation time when packet was sent (seconds)
- **ReceiveTime**: Simulation time when packet was received (seconds, 0 if not delivered)
- **DelayMs**: End-to-end delay in milliseconds
- **Delivered**: 1 if packet reached destination, 0 if dropped
- **WormholeOnPath**: 1 if packet traversed wormhole tunnel, 0 otherwise
- **BlackholeOnPath**: 1 if packet encountered blackhole attacker, 0 otherwise

**Example Usage:**
```bash
./waf --run "routing --enable_wormhole_attack=true --enable_packet_tracking=true"
```

**Analysis Insights:**
- Per-packet delay distribution
- Packet delivery ratio calculation
- Impact of wormhole/blackhole on individual packets
- Attack pattern identification
- Network performance over time

**Analysis Examples:**

1. **Average Delay Comparison:**
   ```python
   import pandas as pd
   df = pd.read_csv('packet-delivery-analysis.csv')
   normal_delay = df[df['WormholeOnPath'] == 0]['DelayMs'].mean()
   wormhole_delay = df[df['WormholeOnPath'] == 1]['DelayMs'].mean()
   print(f"Normal: {normal_delay:.2f}ms, Wormhole: {wormhole_delay:.2f}ms")
   ```

2. **Packet Delivery Ratio:**
   ```python
   pdr = (df['Delivered'].sum() / len(df)) * 100
   print(f"PDR: {pdr:.2f}%")
   ```

3. **Attack Impact Timeline:**
   ```python
   df['SendTime'] = pd.to_numeric(df['SendTime'])
   df.groupby(pd.cut(df['SendTime'], bins=10))['Delivered'].mean().plot()
   ```

---

## üéØ Recommended Test Scenarios

### Scenario 1: Wormhole Attack Impact Assessment
```bash
# Run with attack only
./waf --run "routing --enable_wormhole_attack=true --enable_packet_tracking=true"
# Generates: wormhole-attack-results.csv, packet-delivery-analysis.csv

# Run with attack + detection
./waf --run "routing --enable_wormhole_attack=true --enable_wormhole_detection=true --enable_wormhole_mitigation=true --enable_packet_tracking=true"
# Generates: wormhole-attack-results.csv, wormhole-detection-results.csv, packet-delivery-analysis.csv

# Compare the two packet-delivery-analysis.csv files to measure mitigation effectiveness
```

### Scenario 2: Blackhole Attack and Mitigation Evaluation
```bash
# Run with attack only
./waf --run "routing --enable_blackhole_attack=true --enable_packet_tracking=true"
# Generates: blackhole-attack-results.csv, packet-delivery-analysis.csv

# Run with attack + mitigation
./waf --run "routing --enable_blackhole_attack=true --enable_blackhole_mitigation=true --blackhole_pdr_threshold=0.5 --enable_packet_tracking=true"
# Generates: blackhole-attack-results.csv, blackhole-mitigation-results.csv, packet-delivery-analysis.csv

# Compare PDR and delay before/after mitigation
```

### Scenario 3: Combined Attack Assessment
```bash
./waf --run "routing --enable_wormhole_attack=true --enable_wormhole_detection=true --enable_blackhole_attack=true --enable_blackhole_mitigation=true --enable_packet_tracking=true"
# Generates: All 5 CSV files

# Analyze combined impact of multiple attack types
```

---

## üìà Performance Metrics

### Key Metrics to Extract:

1. **Packet Delivery Ratio (PDR)**
   - Formula: `(Delivered Packets / Total Packets) √ó 100%`
   - Extracted from: `packet-delivery-analysis.csv`

2. **Average End-to-End Delay**
   - Formula: `Average of DelayMs for delivered packets`
   - Extracted from: `packet-delivery-analysis.csv`

3. **Attack Detection Rate**
   - Formula: `(FlowsDetected / FlowsAffected) √ó 100%`
   - Extracted from: `wormhole-detection-results.csv`

4. **Mitigation Effectiveness**
   - Formula: Compare PDR before and after mitigation
   - Extracted from: `blackhole-mitigation-results.csv`

5. **Attack Coverage**
   - Formula: `(Affected Packets / Total Packets) √ó 100%`
   - Extracted from: `packet-delivery-analysis.csv` (WormholeOnPath/BlackholeOnPath columns)

---

## üõ†Ô∏è Configuration Parameters

### Wormhole Detection:
- `--detection_latency_threshold=2.0` - Latency multiplier for detection (default: 2.0)
- `--detection_check_interval=1.0` - Detection check frequency in seconds

### Blackhole Mitigation:
- `--blackhole_pdr_threshold=0.5` - PDR threshold for blacklisting (default: 50%)
- `--blackhole_min_packets=10` - Minimum packets before blacklisting

### Packet Tracking:
- `--enable_packet_tracking=true/false` - Enable detailed per-packet tracking

---

## üìÅ CSV File Locations

All CSV files are generated in the **same directory** where you run the simulation:

```
d:\routing - Copy\
‚îú‚îÄ‚îÄ routing.cc
‚îú‚îÄ‚îÄ wormhole-attack-results.csv
‚îú‚îÄ‚îÄ wormhole-detection-results.csv
‚îú‚îÄ‚îÄ blackhole-attack-results.csv
‚îú‚îÄ‚îÄ blackhole-mitigation-results.csv
‚îî‚îÄ‚îÄ packet-delivery-analysis.csv
```

---

## üîç Example Analysis Workflow

1. **Run baseline simulation** (no attacks):
   ```bash
   ./waf --run "routing --enable_packet_tracking=true"
   mv packet-delivery-analysis.csv baseline.csv
   ```

2. **Run with wormhole attack**:
   ```bash
   ./waf --run "routing --enable_wormhole_attack=true --enable_packet_tracking=true"
   mv packet-delivery-analysis.csv wormhole_attack.csv
   ```

3. **Run with attack + mitigation**:
   ```bash
   ./waf --run "routing --enable_wormhole_attack=true --enable_wormhole_detection=true --enable_wormhole_mitigation=true --enable_packet_tracking=true"
   mv packet-delivery-analysis.csv wormhole_mitigated.csv
   ```

4. **Compare results**:
   ```python
   import pandas as pd
   import matplotlib.pyplot as plt
   
   baseline = pd.read_csv('baseline.csv')
   attack = pd.read_csv('wormhole_attack.csv')
   mitigated = pd.read_csv('wormhole_mitigated.csv')
   
   # Calculate PDR
   pdr_baseline = baseline['Delivered'].mean() * 100
   pdr_attack = attack['Delivered'].mean() * 100
   pdr_mitigated = mitigated['Delivered'].mean() * 100
   
   print(f"PDR - Baseline: {pdr_baseline:.2f}%, Attack: {pdr_attack:.2f}%, Mitigated: {pdr_mitigated:.2f}%")
   
   # Plot delay comparison
   plt.figure(figsize=(10, 6))
   baseline[baseline['Delivered']==1]['DelayMs'].hist(alpha=0.5, label='Baseline', bins=50)
   attack[attack['Delivered']==1]['DelayMs'].hist(alpha=0.5, label='Attack', bins=50)
   mitigated[mitigated['Delivered']==1]['DelayMs'].hist(alpha=0.5, label='Mitigated', bins=50)
   plt.xlabel('Delay (ms)')
   plt.ylabel('Frequency')
   plt.legend()
   plt.title('End-to-End Delay Distribution')
   plt.savefig('delay_comparison.png')
   ```

---

## ‚úÖ Summary

This simulation now exports **5 comprehensive CSV files** covering:

1. ‚úÖ **Attack statistics** (wormhole & blackhole)
2. ‚úÖ **Detection results** (wormhole latency-based detection)
3. ‚úÖ **Mitigation results** (blackhole PDR-based mitigation)
4. ‚úÖ **Per-packet analysis** (detailed delivery and delay tracking)
5. ‚úÖ **Summary report** (printed to console at simulation end)

All mitigation statistics are now exported to CSV files for easy analysis and comparison! üéâ
