╔═══════════════════════════════════════════════════════════════════════════════╗
║   🔧 FIX LINKER ERROR - NS-3 Trying to Build wormhole_attack as Standalone  ║
║                    [2025-10-12 16:00 UTC - UPDATED]                          ║
╚═══════════════════════════════════════════════════════════════════════════════╝

ERROR YOU SAW:
══════════════
[2491/2539] Linking build/scratch/wormhole_attack_impl
/usr/bin/ld: undefined reference to `main'
collect2: error: ld returned 1 exit status

PROBLEM:
════════
NS-3 WAF build system automatically tries to build ALL .cc files in scratch/ 
as standalone executables, regardless of filename. Even wormhole_attack_impl.cc
gets compiled! The file has no main() function - it's meant to be INCLUDED 
in routing.cc, not compiled separately.

SOLUTION: USE .inc EXTENSION
═════════════════════════════
Rename to wormhole_attack.inc - NS-3 NEVER compiles .inc files automatically.
This is the standard way to include implementation files in NS-3 scratch/.

═══════════════════════════════════════════════════════════════════════════════

🚀 QUICK FIX (COPY & PASTE ON LINUX):
══════════════════════════════════════

cd ~/Downloads/ns-allinone-3.35/ns-3.35/scratch

# Rename to .inc (try both possible old names)
mv wormhole_attack.cc wormhole_attack.inc 2>/dev/null || \
mv wormhole_attack_impl.cc wormhole_attack.inc

# Update routing.cc to include the .inc file
sed -i 's/#include "wormhole_attack.*\.cc"/#include "wormhole_attack.inc"/' routing.cc
sed -i 's/#include "wormhole_attack_impl\.cc"/#include "wormhole_attack.inc"/' routing.cc

# Verify
grep "#include.*wormhole" routing.cc

# Build
cd ~/Downloads/ns-allinone-3.35/ns-3.35
./waf clean
./waf build

═══════════════════════════════════════════════════════════════════════════════

EXPECTED OUTPUT:
════════════════
[2539/2539] Linking build/scratch/routing
'build' finished successfully

NO MORE wormhole_attack or wormhole_attack_impl linking attempts!

═══════════════════════════════════════════════════════════════════════════════

WHY .inc EXTENSION WORKS:
═════════════════════════

NS-3 WAF Build Rules:
  ❌ *.cc files → Always compiled as executables (need main())
  ❌ *_impl.cc → Still ends in .cc, so STILL compiled!
  ✅ *.inc files → NEVER compiled, safe to include
  ✅ *.hpp files → NEVER compiled, safe to include

Our Final Structure:
  - wormhole_attack.h → Header declarations
  - wormhole_attack.inc → Implementation (included, not compiled)
  - routing.cc → Main executable (has main(), includes .inc)

═══════════════════════════════════════════════════════════════════════════════

VERIFICATION:
═════════════

After build, check that only routing executable exists:

ls -la build/scratch/

Should see:
  ✅ routing (executable)

Should NOT see:
  ❌ wormhole_attack
  ❌ wormhole_attack_impl

═══════════════════════════════════════════════════════════════════════════════

ALTERNATIVE: Pull Latest from GitHub
═════════════════════════════════════

The fix is already in the GitHub repo! You can:

cd ~/Downloads/ns-allinone-3.35/ns-3.35/scratch
git clone https://github.com/kavindunisansala/routing.git temp
cp temp/routing.cc temp/wormhole_attack.h temp/wormhole_attack.inc .
rm -rf temp

cd ~/Downloads/ns-allinone-3.35/ns-3.35
./waf clean
./waf build

═══════════════════════════════════════════════════════════════════════════════
